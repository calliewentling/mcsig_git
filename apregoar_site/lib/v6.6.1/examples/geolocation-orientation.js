(self.webpackChunk=self.webpackChunk||[]).push([[3085],{8162:function(e,t,a){"use strict";var n=a(8025),o=a(4104),r=a(1625),i=a(7340),c=a(4682),u=a(7842),s=a(640),v=a(4589),d=new s.ZP({center:(0,v.mi)([5.8713,45.6452]),zoom:19}),f=new u.Z({source:new i.Z}),h=new r.Z({layers:[f],target:"map",view:d}),g=document.getElementById("geolocation_marker"),l=new c.Z({positioning:"center-center",element:g,stopEvent:!1});h.addOverlay(l);var m=new o.Z([],"XYZM"),M=new n.Z({projection:d.getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}}),p=500;M.on("change",(function(){var e=M.getPosition(),t=M.getAccuracy(),a=M.getHeading()||0,n=M.getSpeed()||0;!function(e,t,a,n){var o=e[0],r=e[1],i=m.getCoordinates(),c=i[i.length-1],u=c&&c[2];if(u){var s=t-(u%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(Math.abs(s)>Math.PI)s=-(s>=0?1:-1)*(2*Math.PI-Math.abs(s));t=u+s}m.appendCoordinate([o,r,t,a]),m.setCoordinates(m.getCoordinates().slice(-20)),g.src=t&&n?"data/geolocation_marker_heading.png":"data/geolocation_marker.png"}(e,a,Date.now(),n);var o=m.getCoordinates(),r=o.length;r>=2&&(p=(o[r-1][3]-o[0][3])/(r-1));var i,c=["Position: "+e[0].toFixed(2)+", "+e[1].toFixed(2),"Accuracy: "+t,"Heading: "+Math.round((i=a,360*i/(2*Math.PI)))+"&deg;","Speed: "+(3.6*n).toFixed(1)+" km/h","Delta: "+Math.round(p)+"ms"].join("<br />");document.getElementById("info").innerHTML=c})),M.on("error",(function(){alert("geolocation error")}));var w=0;function k(){var e=Date.now()-1.5*p;e=Math.max(e,w),w=e;var t,a,n,o,r=m.getCoordinateAtM(e,!0);r&&(d.setCenter((t=r,a=-r[2],n=d.getResolution(),o=h.getSize()[1],[t[0]-Math.sin(a)*o*n*1/4,t[1]+Math.cos(a)*o*n*1/4])),d.setRotation(-r[2]),l.setPosition(r),h.render())}var b,y=document.getElementById("geolocate");y.addEventListener("click",(function(){M.setTracking(!0),f.on("postrender",k),h.render(),H()}),!1);var _=new XMLHttpRequest;_.open("GET","data/geolocation-orientation.json"),_.onload=function(){b=JSON.parse(_.responseText).data},_.send();var A=document.getElementById("simulate");function D(e){var t=e.coords;M.set("accuracy",t.accuracy),M.set("heading",t.heading*Math.PI*2/360);var a=(0,v.mi)([t.longitude,t.latitude]);M.set("position",a),M.set("speed",t.speed),M.changed()}function H(){y.disabled="disabled",A.disabled="disabled"}A.addEventListener("click",(function(){var e=b,t=e.shift();D(t);var a=t.timestamp;!function t(){var n=e.shift();if(n){var o=n.timestamp;D(n),window.setTimeout((function(){a=o,t()}),(o-a)/.5)}}(),f.on("postrender",k),h.render(),H()}),!1)}},function(e){"use strict";var t;t=8162,e(e.s=t)}]);
//# sourceMappingURL=geolocation-orientation.js.map