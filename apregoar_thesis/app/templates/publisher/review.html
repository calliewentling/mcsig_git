{% extends "publisher/templates/publisher_template.html" %}

{% block title %}Review{% endblock %}

{% block main %}
<head>
<style>
/* https://www.w3schools.com/howto/howto_js_collapsible.asp */
/* Style the button that is used to open and close the collapsible content */

</style>
</head>

  <!--<script src="{{ url_for('static', filename='js/create.js') }}"></script>-->

  <div class="container">
    <div class="row">
      <div class="col">
  
        <h1> {{ story["title"] }} </h1>
        <hr>

        <!-- THIS IS UNTESTED -->
        <div class ="card">
          <div class = "card-body">
            <h2>{{ story["section"] }}, {{ story["pub_date"] }}</h2>
            <h3>{{ story["publication"] }} </h3>
            <p>{{ story["summary"] }}</p>
            <div class="align-right">
              <p><i>{{ story["tags"] }}</i> </p>
            </div>
            
          </div>
        </div>
        
        <div class="card">
          <div class = "card-body">
            <h2>Localizações</h2> 

            

            <div class="container1">
              <label class="switch">
                <input id ="tswitch" type="checkbox" onclick = "toggleMap()">
                <span class="slider round"></span>
              </label>
            </div>

            
            <!-- THIS IS THE INSTANCE LIST -->
            <div id="instanceList" style="display:none">

              <script>
                var storyID = "{{ sID }}"; //Replace with a function to get the actual s_id
                console.log(storyID);
                //Apparently document.write is considered bad practice. Replace in the future with something better
                document.write('<p> <a href="/publisher/'+storyID+'/localize"> <button type="button" class="btn btn-primary">Associar localização</button></a>');
              </script>
  
              <br>

              <form action="review" method="POST">
                {% if instances|length > 0 %}
                  {% for instance in instances %}
                    {% for iID, attributes in instance.items() %}
                      {% set instanceID = "instance" ~ iID %}
                      <label>
                        <input id = "{{ instanceID }}" name = "{{ instanceID }}" type="checkbox" class = "listInstances"> {{ instanceID }} {{ attributes["p_name"] }} <i> {{ attributes["t_begin"] }} to {{ attributes["t_end"] }} </i>
                      </label>

                      <!--
                      <script>
                        var instanceID = "{{ iID }}";
                        document.write('<input type="checkbox" class="listInstances" id="instance'+instanceID+'" name="instance'+instanceID+'"> {{ attributes["p_name"] }} <i> {{ attributes["t_begin"] }} to {{ attributes["t_end"] }} </i> ')
                      </script>


                        <label>
                          <input type="checkbox" > {{ attributes["p_name"] }} <i> {{ attributes["t_begin"] }} to {{ attributes["t_end"] }} </i> 
                        </label>
                      <script>
                          var instanceID = "{{ iID }}";
                          document.write('<p> <a href="/publisher/'+instanceID+'/edit_instance">{{ attributes["p_name"] }}</a> <i> {{ attributes["t_begin"] }} to {{ attributes["t_end"] }} </i></p>');
                      </script>
                        -->
                      
                    {% endfor %}
                  {% endfor %}
                {% else %}
                  <p><i>No instances associated with this story</i></p>
                {% endif %}
                <br>
                <button type="submit" class="btn btn-primary" id="submitDeleteI">Quer Eliminar</button>
              </form>
            </div>
              
            <!-- THIS IS THE INSTANCE MAP -->
            <div id="instanceMap" style="display:block">
              <p>(This is where the map of existing instances will go)</p>
              <div id="map" class="map"></div>
              <!--<div id="info">&nbsp;</div>-->
              <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-instances"></div>
                <div id="popup-story" display="none"></div>
              </div>
              <div id="info"></div>
            </div>
            


          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleMap(){
      //Get the checkbox
      var tswitch = document.getElementById("tswitch");
      //Get output text
      var instanceList = document.getElementById("instanceList");

      //If the checkbox is checked, display the output text
      if (tswitch.checked == true){
        instanceList.style.display = "block";
        instanceMap.style.display = "none";
      } else {
        instanceList.style.display = "none";
        instanceMap.style.display = "block";
      }
    }

    var mapFilter = "s_id="+storyID;

    

  </script>

{% endblock %}